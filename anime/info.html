<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="utf-8">
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="all">
    <title>HUASTREAM | Nonton Donghua & Anime Bahasa Indonesia</title>
    <meta name="description" content="HUASTREAM.YYDZ adalah tempat nonton donghua dan anime online terlengkap dengan subtitle Indonesia. Mulai dari Action, Fantasy, Romance, Isekai, Comedy, hingga Cultivation dan Martial Arts, semua bisa kamu tonton gratis dengan kualitas terbaik. Koleksi lengkap donghua terbaru dan anime populer tersedia di HUASTREAM.YYDZ untuk pengalaman menonton seru tanpa batas.">
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="HUASTREAM.YYDZ" />
    <meta property="og:title" content="HUASTREAM | Nonton Donghua & Anime Bahasa Indonesia" />
    <meta property="og:image" content="https://raw.githubusercontent.com/Yudzxml/UploaderV2/main/tmp/55337a9f.png" />
   <meta property="og:description" content="HUASTREAM.YYDZ adalah platform nonton donghua dan anime terbaru dengan subtitle Indonesia. Koleksi lengkap dari Action, Fantasy, Isekai, Romance, hingga Cultivation bisa kamu tonton gratis!" />
   <meta property="og:url" content="https://huastream.yydz.my.id" />
   <meta name="keywords" content="nonton donghua, nonton anime, donghua sub indo, anime sub indo, streaming anime, streaming donghua, anime terbaru, donghua terbaru, huastream" itemprop="keywords" />
   <meta content="Nonton anime dan donghua sub indo terbaru hari ini dengan kualitas terbaik hanya di HUASTREAM.YYDZ." itemprop="headline" />
    <meta name="thumbnailUrl" content="https://raw.githubusercontent.com/Yudzxml/UploaderV2/main/tmp/55337a9f.png" itemprop="thumbnailUrl" />
    <meta content="https://huastream.yydz.my.id" itemprop="url" />
    <link rel="canonical" href="https://huastream.yydz.my.id" />
    <link rel="icon" href="https://raw.githubusercontent.com/Yudzxml/UploaderV2/main/tmp/26250dc9.png">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="manifest" href="../manifest.json" />
    
    <meta name="theme-color" content="#2563eb" />
     <script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("../service-worker.js")
     }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <!-- Tailwind CSS -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.2/dist/tailwind.min.css" rel="stylesheet">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <!-- Font Awesome 6 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
  *,
*::before,
*::after { box-sizing: border-box; }

:root{
  --bg:#f6f8fb;
  --surface: rgba(255,255,255,0.85);
  --text:#0f1724;
  --muted:#6b7280;
  --accent1:#2563eb;
  --accent2:#7c3aed;
  --glass: rgba(255,255,255,0.6);
}

html,body{ height:100%; }

body{
  margin:0;
  font-family:'Poppins', 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  background: linear-gradient(180deg,#fbfdff 0%, #eef6ff 40%, var(--bg) 100%);
  color:var(--text);
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  line-height:1.4;
  -webkit-tap-highlight-color: transparent;
}

.container{
  max-width:1200px;
  margin:0 auto;
  padding:0 1rem;
}

/* header */
header{
  position:sticky;
  top:0;
  z-index:60;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:1rem;
  padding:.65rem 0;
  backdrop-filter: blur(8px) saturate(120%);
  background: linear-gradient(180deg, rgba(255,255,255,0.7), rgba(255,255,255,0.55));
  border-bottom: 1px solid rgba(15,23,42,0.04);
  transition: box-shadow .22s ease, transform .18s ease;
}

header.elev{ box-shadow: 0 8px 30px rgba(15,23,42,0.06); transform: translateY(-1px); }

/* logo */
header h1{
  display:flex;
  align-items:center;
  gap:.6rem;
  margin:0;
  font-weight:800;
  font-size:1.25rem;
  letter-spacing:-0.2px;
  background: linear-gradient(90deg,var(--accent1),var(--accent2));
  -webkit-background-clip:text;
  background-clip:text;
  color:transparent;
}

/* logo icon badge */
.logo-badge{
  display:inline-grid;
  place-items:center;
  width:36px;
  height:36px;
  border-radius:10px;
  background: linear-gradient(135deg, rgba(37,99,235,0.12), rgba(124,58,237,0.10));
  box-shadow: 0 6px 18px rgba(37,99,235,0.08);
  color:var(--accent1);
  font-size:1rem;
}

/* search form (pill) */
#searchForm{
  display:flex;
  align-items:center;
  gap:.3rem;
  padding:3px 6px;
  border-radius:9999px;
  background: var(--surface);
  box-shadow: 0 6px 18px rgba(2,6,23,0.04);
  border: 1px solid rgba(15,23,42,0.05);
  transition: box-shadow .18s ease, transform .18s ease;
  max-width: 260px; 
}

/* focus state */
#searchForm:focus-within{
  box-shadow: 0 10px 28px rgba(37,99,235,0.08);
  transform: translateY(-1.5px);
  border-color: rgba(99,102,241,0.12);
}

/* input */
#searchInput{
  background: transparent;
  border: none;
  padding:.4rem .6rem;
  width: 100%;
  max-width: 180px;   /* <-- lebih ramping */
  font: 500 .9rem/1.2 'Inter', system-ui, sans-serif;
  color:var(--text);
  caret-color: var(--accent1);
  outline: none;
}

/* button */
#searchBtn{
  display:inline-flex;
  align-items:center;
  gap:.3rem;
  border:none;
  padding:.4rem .7rem;
  border-radius:9999px;
  font-weight:600;
  font-size:.85rem;
  color:#fff;
  background: linear-gradient(90deg,var(--accent1),var(--accent2));
  cursor:pointer;
  box-shadow: 0 8px 20px rgba(37,99,235,0.1);
  transition: transform .14s cubic-bezier(.2,.8,.2,1), box-shadow .14s ease;
}

/* hover/active */
#searchBtn:hover{ transform: translateY(-2px); box-shadow: 0 14px 28px rgba(37,99,235,0.14); }
#searchBtn:active{ transform: translateY(0); box-shadow: 0 6px 16px rgba(37,99,235,0.1); }

/* responsive */
@media (max-width:880px){
  .container{ padding:0 .9rem; }
  #searchForm{ max-width: 100%; }
  #searchInput{ max-width: 100%; }
}

@media (max-width:640px){
  header{ flex-direction:column; align-items:stretch; gap:.6rem; padding:.6rem 0; }
  header h1{ justify-content:center; width:100%; }
  #searchForm{ width:100%; max-width: 100%; } 
  #searchInput{ flex:1; width:100%; }
  #searchBtn{ padding:.5rem .7rem; font-size:.85rem; }
}

/* dark mode */
@media (prefers-color-scheme: dark){
  :root{ --text:#e6eef8; --muted:#9ca3af; --bg:#071025; --surface: rgba(10,14,20,0.55); }
  body{ background: linear-gradient(180deg,#041226 0%, #071025 60%); color:var(--text); }
  header{ background: linear-gradient(180deg, rgba(8,10,15,0.6), rgba(6,8,12,0.55)); border-bottom: 1px solid rgba(255,255,255,0.03); }
  #searchForm{ background: var(--surface); border: 1px solid rgba(255,255,255,0.03); box-shadow: 0 10px 30px rgba(2,6,23,0.45); }
  #searchInput{ color:var(--text); }
}

.rekom-text {
  font-size: 1rem; /* kecil */
  font-weight: 600;
  text-align: center; /* tengah */
  margin-bottom: 0.75rem;
  color: #ffff; /* bisa diganti sesuai tema */
}

/* Gradient untuk ikon */
.gradient-icon {
  background: linear-gradient(90deg, #3b82f6, #06b6d4); /* biru ke cyan */
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

/* ===========================
   Layout dasar agar footer di bawah
=========================== */
html, body {
  height: 100%;
  margin: 0;
  padding: 0;
}
/* ===========================
   Konten utama fleksibel
=========================== */
main {
  padding: 1rem;
}

/* ===========================
   Footer styling
=========================== */
.footer {
  background-color: var(--bg);
  color: var(--text);
  text-align: center;
  padding: 1rem 0 0; 
  border-radius: 1rem 1rem 0 0;
  font-family: 'Poppins', sans-serif;
  position: relative;
  flex-shrink: 0; /* jangan mengecil */
}

.footer .container {
  max-width: 600px;
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  gap: 0.2rem;
  align-items: center;
  padding: 0.75rem 1rem;
  border-radius: 1rem;
  transition: box-shadow 0.2s ease, transform 0.15s ease;
}

.footer .container:active {
  box-shadow: 0 8px 20px rgba(37,99,235,0.3);
  transform: translateY(-1px);
}

.footer .copyright {
  font-size: 0.8rem;
}
.footer p {
  margin: 0.5rem 0;
}
.footer .contact-icons {
  display: flex;
  justify-content: center;
  gap: 1rem;
  font-size: 1.3rem;
}

.footer .contact-icons a {
  transition: transform 0.2s;
  background: linear-gradient(90deg, var(--accent1), var(--accent2));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.footer .contact-icons a:active {
  transform: scale(1.2);
}

.footer .team {
  font-size: 0.75rem;
}

.footer::after {
  content: "";
  position: absolute;
  left: 0;
  right: 0;
  bottom: 0;
  height: 50px;
  background-color: var(--bg);
  z-index: -1;
}

.gradient-text {
  transition: transform 0.2s;
  background: linear-gradient(90deg, var(--accent1), var(--accent2));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

/* Dark mode */
@media (prefers-color-scheme: dark) {
  .footer {
    background-color: var(--surface, #0a0e14);
    color: var(--text, #e6eef8);
  }
}
</style>
<style>
/* --- Wrapper utama (glass card) --- */
.anime-detail-wrapper {
  display: flex;
  flex-direction: column;
  gap: 2rem;
  align-items: center;
  padding: 2rem 1rem;
  width: 100%;
  max-width: 900px;
  margin: 2rem auto;
  background: var(--surface, rgba(255,255,255,0.85));
  backdrop-filter: blur(12px);
  border-radius: 1rem;
  box-shadow: 0 6px 24px rgba(0,0,0,0.08);
  transition: transform 0.25s ease, box-shadow 0.25s ease;
}

.anime-detail-wrapper:hover {
  transform: translateY(-2px);
  box-shadow: 0 12px 36px rgba(0,0,0,0.12);
}

/* --- Thumbnail utama + overlay gradient --- */
.anime-thumb-container {
  position: relative;
  width: 100%;
  max-width: 600px;
  display: flex;
  justify-content: center;
  align-items: center;
  border-radius: 1rem;
  overflow: hidden;
}

/* Gradient overlay tetap tapi tidak berubah saat hover */
.anime-thumb-container::after {
  content: "";
  position: absolute;
  left: 0;
  right: 0;
  bottom: 0;
  height: 50%; /* separuh dari bawah */
  background: linear-gradient(to top, rgba(0, 123, 255, 0.5), rgba(0, 123, 255, 0));
  pointer-events: none;
  border-radius: 0 0 1rem 1rem; 
  transition: none; /* hapus transisi background */
}

.main-thumb {
  width: 70%;
  border-radius: 1rem;
  box-shadow: 0 6px 20px rgba(0,0,0,0.08);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

/* Hover hanya zoom + shadow */
.main-thumb:hover {
  transform: scale(1.02);
  box-shadow: 0 12px 28px rgba(0,0,0,0.12);
}

/* Hilangkan efek hover overlay */
.anime-thumb-container:hover::after {
  /* kosongkan */
}

/* --- Info container --- */
.anime-info-container {
  width: 100%;
  display: flex;
  flex-direction: column;
  gap: 1rem;
  text-align: center;
}

/* --- Judul --- */
.anime-title {
  font-size: 1.8rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
  color: var(--text, #0f1724);
  letter-spacing: 0.3px;
}

/* --- Rating --- */
.anime-rating {
  display: inline-block;
  padding: 4px 12px;
  background: linear-gradient(135deg, var(--accent1), var(--accent2));
  color: #fff;
  font-weight: 600;
  font-size: 0.9rem;
  border-radius: 9999px;
  margin-bottom: 0.5rem;
  box-shadow: 0 4px 12px rgba(0,0,0,0.06);
  transition: transform 0.2s ease;
}

.anime-rating:hover {
  transform: scale(1.05);
}

/* --- Genre badges --- */
.anime-genres {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 6px;
  margin-bottom: 1rem;
}

.anime-genres .badge {
  padding: 4px 12px;
  font-size: 0.85rem;
  font-weight: 500;
  border-radius: 9999px;
  background: linear-gradient(135deg, var(--accent1), var(--accent2));
  color: #fff;
  transition: transform 0.25s ease, box-shadow 0.25s ease;
}

.anime-genres .badge:hover {
  transform: scale(1.05);
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}

/* --- Synopsis --- */
.anime-synopsis {
  font-size: 0.95rem;
  line-height: 1.5;
  color: var(--muted, #6b7280);
  padding: 0 1rem;
  text-align: center;
}

/* Info tabel */
.anime-info table {
  border-collapse: collapse;
  width: 100%;
  margin: 1rem 0;
  font-size: 0.95rem;
}

.anime-info table td {
  padding: 8px 12px;
  vertical-align: top;
  border-bottom: 1px solid rgba(15,23,42,0.08);
}

/* --- Episodes grid --- */
.anime-episodes {
  width: 100%;
}

.anime-episodes h3 {
  margin-bottom: 0.5rem;
  font-size: 1.1rem;
  font-weight: 600;
}

.anime-episodes ul {
  list-style: none;
  padding: 0;
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
  gap: 8px;
  max-height: 320px;
  overflow-y: auto;
}

.anime-episodes a {
  display: block;
  text-align: center;
  padding: 8px 6px;
  border-radius: 0.75rem;
  background: rgba(0,0,0,0.03);
  text-decoration: none;
  color: var(--accent1);
  font-weight: 500;
  font-size: 0.85rem;
  transition: all 0.2s ease;
}

.anime-episodes a:hover {
  background: rgba(37,99,235,0.08);
  transform: scale(1.02);
}

.anime-episodes a.active {
  background: rgba(37,99,235,0.15);
  font-weight: 600;
}

/* button nonton episode */
.btn-watch-ep1 {
  display: inline-flex;
  align-items: center;
  justify-content: center; /* center teks & icon */
  gap: .3rem; /* jarak icon & teks */
  border: none;
  padding: .3rem .8rem; /* cukup nyaman dan proporsional */
  border-radius: 9999px; /* pill shape */
  font-weight: 600;
  font-size: .85rem;
  color: #fff;
  background: linear-gradient(90deg, var(--accent1, #ff416c), var(--accent2, #ff4b2b));
  cursor: pointer;
  box-shadow: 0 8px 20px rgba(37,99,235,0.1);
  transition: transform .14s cubic-bezier(.2,.8,.2,1), box-shadow .14s ease;
  white-space: nowrap; /* tetap satu baris */
}

.btn-watch-ep1 i {
  font-size: 0.9rem;
}

/* hover/active */
.btn-watch-ep1:hover {
  transform: translateY(-2px);
  box-shadow: 0 14px 28px rgba(37,99,235,0.14);
}

.btn-watch-ep1:active {
  transform: translateY(0);
  box-shadow: 0 6px 16px rgba(37,99,235,0.1);
}

/* --- Responsif --- */
@media (max-width: 720px) {
  .anime-detail-wrapper {
    padding: 1rem;
  }

  .anime-synopsis {
    padding: 0 0.5rem;
  }

  .anime-episodes ul {
    max-height: 250px;
  }
}

/* --- Dark mode --- */
@media (prefers-color-scheme: dark) {
  .anime-detail-wrapper {
    background: var(--surface, rgba(10,14,20,0.55));
    box-shadow: 0 6px 20px rgba(0,0,0,0.3);
  }

  .anime-title,
  .anime-info table td:first-child {
    color: #e6eef8;
  }

  .anime-synopsis {
    color: var(--muted, #9ca3af);
  }

  .anime-episodes a {
    background: rgba(255,255,255,0.05);
    color: var(--accent1);
  }

  .anime-episodes a:hover {
    background: rgba(37,99,235,0.15);
  }

  .anime-episodes a.active {
    background: rgba(37,99,235,0.25);
  }
}
</style>
</head>
<body class="text-gray-900">

 <!-- Header -->
  <header class="bg-white shadow p-4 flex justify-between items-center sticky top-0 z-50">
    <h1 class="text-2xl font-bold text-blue-600 flex items-center gap-2">
      HUASTREAM.YYDZ
    </h1>
    <form id="searchForm" class="flex items-center">
      <input type="text" id="searchInput" placeholder="Cari Donghua atau Anime..." class="focus:outline-none px-2 py-1 border rounded" required>
      <button type="submit" id="searchBtn" class="bg-blue-600 text-white px-3 py-2 hover:bg-blue-700 flex items-center gap-1">
        <i class="fas fa-search"></i> Cari
      </button>
    </form>
  </header>

  <main class="p-4 space-y-8">
  <div class="content" id="animeDetail">
    <p class="text-center text-gray-500">Loading detail...</p>
  </div>
  <!-- Footer / Copyright & Contact -->
<footer class="footer">
  <div class="container">
    <p class="copyright">
      © 2025 <strong>HUASTREAM.YYDZ</strong>. All rights reserved.
    </p>
    <p class="contact-icons">
      <a href="https://wa.me/6283872031397" target="_blank" class="icon-gradient"><i class="fab fa-whatsapp"></i></a>
      <a href="https://t.me/Yudzxzy" target="_blank" class="icon-gradient"><i class="fab fa-telegram-plane"></i></a>
      <a href="mailto:yudaaryaardhana1122@email.com" class="icon-gradient"><i class="fas fa-envelope"></i></a>
    </p>
    <p class="team">
      Design & development <span class="font-semibold gradient-text">Tim Yudzxml</span>
    </p>
  </div>
</footer>
</main>
  <!-- Bottom Nav -->
  <nav class="bottom-nav">
    <a href="/anime/home.html" class="nav-link active"><i class="fas fa-home"></i><span>Home</span></a>
    <a href="/anime/search.html" class="nav-link"><i class="fas fa-search"></i><span>Cari</span></a>
    <a href="../bookmark.html" class="nav-link"><i class="fas fa-bookmark"></i><span>Bookmark</span></a>
    <a href="/anime/profil.html" class="nav-link"><i class="fas fa-user"></i><span>Akun</span></a>
  </nav>
  <style>
    /* =======================
   BOTTOM NAV
======================= */
main {
  padding-bottom: 70px;
}
.bottom-nav{
  position:fixed;bottom:0;left:0;right:0;
  display:flex;justify-content:space-around;
  background:var(--surface);backdrop-filter:blur(12px) saturate(120%);
  border-top:1px solid rgba(15,23,42,0.05); padding:0.5rem 0; z-index:60; box-shadow:0 -2px 8px rgba(0,0,0,0.05);
}
.bottom-nav .nav-link{
  display:flex;flex-direction:column;align-items:center;gap:0.2rem;
  color:var(--muted); font-size:0.7rem; text-decoration:none; transition: all 0.2s ease; position:relative;
}
.bottom-nav .nav-link i{
  font-size:1.2rem; transition: all 0.2s ease; background: linear-gradient(90deg,var(--accent1),var(--accent2));
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
}
.bottom-nav .nav-link.active i, .bottom-nav .nav-link:hover i{
  transform:translateY(-2px) scale(1.1); filter: drop-shadow(0 2px 4px rgba(37,99,235,0.4));
}
.bottom-nav .nav-link.active span, .bottom-nav .nav-link:hover span{
  color:var(--accent1); font-weight:600;
}
@media(prefers-color-scheme:dark){
  .bottom-nav{background:var(--surface); border-top:1px solid rgba(255,255,255,0.05); box-shadow:0 -2px 8px rgba(0,0,0,0.2);}
  .bottom-nav .nav-link{color:var(--muted);}
  .bottom-nav .nav-link.active span,.bottom-nav .nav-link:hover span{color:var(--accent1);}
}
@media(max-width:480px){.bottom-nav .nav-link span{font-size:0.65rem;} .bottom-nav .nav-link i{font-size:1.1rem;}}
  </style>
<script>
const animeDetailContainer = document.getElementById('animeDetail');

// Key untuk tiap tab
const keysMap = {
  top: 'targetData_top',
  latest: 'targetData_latest',
  schedule: 'targetData_schedule',
  default: 'targetData'
};

let activeKey = null;

// --- Fungsi load detail ---
async function loadDetail(animeUrl) {
  if (!animeUrl) {
    animeDetailContainer.innerHTML = '<p class="text-center text-red-500">ID Anime tidak ditemukan.</p>';
    return;
  }

  const apiMain = `https://www.sankavollerei.com/anime/samehadaku/anime/${animeUrl}`;
  const apiFallback = `https://api.yudzxyz.x-server.my.id/api/samehadaku?action=detail&url=https://v1.samehadaku.how/anime/${animeUrl}/`;

  animeDetailContainer.innerHTML = '<p class="text-center text-gray-500">Loading detail...</p>';

  let animeStorage = null;

  try {
    // 🔹 API utama
    const res = await axios.get(apiMain);
    const data = res.data?.data;

    if (!data) throw new Error("Data kosong dari API utama");

    animeStorage = {
      title: data.title || data.english || data.japanese || 'Judul Tidak Tersedia',
      image: data.poster || '',
      description: data.synopsis?.paragraphs?.join(' ') || 'Deskripsi tidak tersedia.',
      scoreValue: data.score?.value || 'N/A',
      scoreUsers: data.score?.users || '0',
      type: data.type || '-',
      status: data.status || '-',
      source: data.source || '-',
      duration: data.duration || '-',
      season: data.season || '-',
      studios: data.studios || '-',
      producers: data.producers || '-',
      aired: data.aired || '-',
      episodes: (data.episodeList || []).map(ep => ({
        number: ep.title,
        title: `Episode ${ep.title}`,
        link: ep.samehadakuUrl + ep.href,
        episodeId: ep.episodeId
      })),
      genres: data.genreList?.map(g => g.title) || []
    };

  } catch (err) {
    console.warn("⚠️ Gagal ambil dari API utama, fallback ke API kedua...", err);

    try {
      const res2 = await axios.get(apiFallback);
      const result = res2.data?.result;

      if (!result) throw new Error("Data kosong dari API fallback");

      animeStorage = {
        title: result.title || result.english || result.japanese || 'Judul Tidak Tersedia',
        image: result.img || '',
        description: result.description || 'Deskripsi tidak tersedia.',
        scoreValue: result.ratingValue || 'N/A',
        scoreUsers: result.ratingCount || '0',
        type: result.details?.Type || '-',
        status: result.details?.Status || '-',
        source: result.details?.Source || '-',
        duration: result.details?.Duration || '-',
        season: result.details?.Season || '-',
        studios: result.details?.Studio || '-',
        producers: result.details?.Producers || '-',
        aired: result.details?.Released || '-',
        episodes: (result.episodes || []).map(ep => ({
          number: ep.number,
          title: ep.title,
          link: ep.link,
          episodeId: ep.link
        })),
        genres: result.genres || []
      };

    } catch (err2) {
      console.error("❌ Fallback juga gagal:", err2);
      animeDetailContainer.innerHTML = '<p class="text-center text-red-500">Tidak bisa memuat detail anime.</p>';
      return;
    }
  }

  // ✅ Simpan ke storage
  localStorage.setItem('animeData', JSON.stringify(animeStorage));
  animeStorage.episodes.forEach(ep => {
    localStorage.setItem(ep.episodeId, JSON.stringify(ep));
  });

  // 🔹 Render genres
  const genresHTML = (animeStorage.genres || [])
    .map(g => `<span class="badge">${g}</span>`)
    .join(' ');

  // 🔹 Render episodes (urut terbaru)
  const episodesHTML = (animeStorage.episodes || [])
    .sort((a, b) => Number(b.number) - Number(a.number))
    .map(ep => `<li><a href="#" data-ep-id="${ep.episodeId}">${ep.title}</a></li>`)
    .join('');

  const firstEpisodeId = (animeStorage.episodes || [])
    .sort((a, b) => Number(a.number) - Number(b.number))[0]?.episodeId || null;

  // 🔹 Render HTML utama
  animeDetailContainer.innerHTML = `
<div class="anime-detail-wrapper">
  <div class="anime-thumb-container">
    <img src="${animeStorage.image}" alt="${animeStorage.title}" class="main-thumb">
  </div>
  <div class="anime-info-container">
    <h2 class="anime-title">${animeStorage.title}</h2>
    <span class="anime-rating"><i class="fa fa-star" style="color: gold;"></i> ${animeStorage.scoreValue} (${animeStorage.scoreUsers} votes)</span>
    <div class="anime-genres">${genresHTML}</div>
    <p class="anime-synopsis">${animeStorage.description}</p>
    <div class="anime-info">
      <h3>Info:</h3>
      <table>
        <tr><td>Status</td><td>${animeStorage.status}</td></tr>
        <tr><td>Type</td><td>${animeStorage.type}</td></tr>
        <tr><td>Source</td><td>${animeStorage.source}</td></tr>
        <tr><td>Duration</td><td>${animeStorage.duration}</td></tr>
        <tr><td>Season</td><td>${animeStorage.season}</td></tr>
        <tr><td>Studios</td><td>${animeStorage.studios}</td></tr>
        <tr><td>Producers</td><td>${animeStorage.producers}</td></tr>
        <tr><td>Aired</td><td>${animeStorage.aired}</td></tr>
      </table>
    </div>
    <button class="btn-watch-ep1"><i class="fas fa-play"></i> Nonton EPS 1</button>
    <div class="anime-episodes"><h3>Episodes:</h3><ul>${episodesHTML}</ul></div>
  </div>
</div>
`;

  // 🔹 Event klik tombol EPS 1
  document.querySelector('.btn-watch-ep1')?.addEventListener('click', () => {
    if (firstEpisodeId) {
      sessionStorage.setItem('targetData', firstEpisodeId);
      window.location.href = '/anime/preview.html';
    }
  });

  // 🔹 Event klik semua episode
  document.querySelectorAll('.anime-episodes a[data-ep-id]').forEach(link => {
    link.addEventListener('click', e => {
      e.preventDefault();
      const epId = link.getAttribute('data-ep-id');
      if (epId) {
        sessionStorage.setItem('targetData', epId);
        window.location.href = '/anime/preview.html';
      }
    });
  });
}

// --- Fungsi buka tab ---
function openTab(type, animeUrl) {
  Object.values(keysMap).forEach(k => {
    localStorage.removeItem(k);
    sessionStorage.removeItem(k);
  });

  const key = keysMap[type] || keysMap.default;
  if (animeUrl) sessionStorage.setItem(key, JSON.stringify({url: animeUrl}));
  activeKey = key;

  loadDetail(animeUrl);
}

// --- Ambil key saat reload halaman ---
let foundUrl = null;
for (let key of Object.values(keysMap)) {
  const data = sessionStorage.getItem(key) || localStorage.getItem(key);
  if (data) {
    try {
      const parsed = JSON.parse(data);
      foundUrl = parsed?.animeId || parsed.animeId || parsed?.url || parsed;
      activeKey = key;
      break;
    } catch {
      foundUrl = data;
      activeKey = key;
      break;
    }
  }
}

loadDetail(foundUrl);

// --- Event tab ---
const topAnimeList      = JSON.parse(localStorage.getItem('list_top') || '[]');
const latestAnimeList   = JSON.parse(localStorage.getItem('list_latest') || '[]');
const scheduleAnimeList = JSON.parse(localStorage.getItem('list_schedule') || '[]');

function getFirstAnimeUrl(list) {
  if (!Array.isArray(list) || list.length === 0) return null;
  return list[0]?.animeId || null; 
}

document.getElementById('tabTop')?.addEventListener('click', () => {
  const url = getFirstAnimeUrl(topAnimeList);
  if (url) openTab('top', url);
});
document.getElementById('tabLatest')?.addEventListener('click', () => {
  const url = getFirstAnimeUrl(latestAnimeList);
  if (url) openTab('latest', url);
});
document.getElementById('tabSchedule')?.addEventListener('click', () => {
  const url = getFirstAnimeUrl(scheduleAnimeList);
  if (url) openTab('schedule', url);
});

// --- Search form ---
document.getElementById('searchForm')?.addEventListener('submit', e => {
  e.preventDefault();
  const query = document.getElementById('searchInput').value.trim();
  if (!query) return;
  sessionStorage.setItem('searchQuery', query);
  window.location.href = '/anime/search.html';
});
</script>
<script src="https://fpyf8.com/88/tag.min.js" data-zone="165468" async data-cfasync="false">
</script>
</body>
</html>