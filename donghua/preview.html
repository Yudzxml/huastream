<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="utf-8">
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="all">
    <title>HUASTREAM | Nonton Donghua & Anime Bahasa Indonesia</title>
    <meta name="description" content="HUASTREAM.YYDZ adalah tempat nonton donghua dan anime online terlengkap dengan subtitle Indonesia. Mulai dari Action, Fantasy, Romance, Isekai, Comedy, hingga Cultivation dan Martial Arts, semua bisa kamu tonton gratis dengan kualitas terbaik. Koleksi lengkap donghua terbaru dan anime populer tersedia di HUASTREAM.YYDZ untuk pengalaman menonton seru tanpa batas.">
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="HUASTREAM.YYDZ" />
    <meta property="og:title" content="HUASTREAM | Nonton Donghua & Anime Bahasa Indonesia" />
    <meta property="og:image" content="https://raw.githubusercontent.com/Yudzxml/UploaderV2/main/tmp/55337a9f.png" />
   <meta property="og:description" content="HUASTREAM.YYDZ adalah platform nonton donghua dan anime terbaru dengan subtitle Indonesia. Koleksi lengkap dari Action, Fantasy, Isekai, Romance, hingga Cultivation bisa kamu tonton gratis!" />
   <meta property="og:url" content="https://huastream.yydz.my.id" />
   <meta name="keywords" content="nonton donghua, nonton anime, donghua sub indo, anime sub indo, streaming anime, streaming donghua, anime terbaru, donghua terbaru, huastream" itemprop="keywords" />
   <meta content="Nonton anime dan donghua sub indo terbaru hari ini dengan kualitas terbaik hanya di HUASTREAM.YYDZ." itemprop="headline" />
    <meta name="thumbnailUrl" content="https://raw.githubusercontent.com/Yudzxml/UploaderV2/main/tmp/55337a9f.png" itemprop="thumbnailUrl" />
    <meta content="https://huastream.yydz.my.id" itemprop="url" />
    <link rel="canonical" href="https://huastream.yydz.my.id" />
    <link rel="icon" href="https://raw.githubusercontent.com/Yudzxml/UploaderV2/main/tmp/26250dc9.png">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="manifest" href="../manifest.json" />
    <meta name="theme-color" content="#2563eb" />
     <script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("../service-worker.js")
     }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.2/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  
  <!-- Firebase Auth -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  
  <!-- Firebase Firestore -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
  *,
*::before,
*::after { box-sizing: border-box; }

:root{
  --bg:#f6f8fb;
  --surface: rgba(255,255,255,0.85);
  --text:#0f1724;
  --muted:#6b7280;
  --accent1:#2563eb;
  --accent2:#7c3aed;
  --glass: rgba(255,255,255,0.6);
}

html,body{ height:100%; }

body{
  margin:0;
  font-family:'Poppins', 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  background: linear-gradient(180deg,#fbfdff 0%, #eef6ff 40%, var(--bg) 100%);
  color:var(--text);
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  line-height:1.4;
  -webkit-tap-highlight-color: transparent;
}

.container{
  max-width:1200px;
  margin:0 auto;
  padding:0 1rem;
}

/* header */
header{
  position:sticky;
  top:0;
  z-index:60;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:1rem;
  padding:.65rem 0;
  backdrop-filter: blur(8px) saturate(120%);
  background: linear-gradient(180deg, rgba(255,255,255,0.7), rgba(255,255,255,0.55));
  border-bottom: 1px solid rgba(15,23,42,0.04);
  transition: box-shadow .22s ease, transform .18s ease;
}

header.elev{ box-shadow: 0 8px 30px rgba(15,23,42,0.06); transform: translateY(-1px); }

/* logo */
header h1{
  display:flex;
  align-items:center;
  gap:.6rem;
  margin:0;
  font-weight:800;
  font-size:1.25rem;
  letter-spacing:-0.2px;
  background: linear-gradient(90deg,var(--accent1),var(--accent2));
  -webkit-background-clip:text;
  background-clip:text;
  color:transparent;
}

/* logo icon badge */
.logo-badge{
  display:inline-grid;
  place-items:center;
  width:36px;
  height:36px;
  border-radius:10px;
  background: linear-gradient(135deg, rgba(37,99,235,0.12), rgba(124,58,237,0.10));
  box-shadow: 0 6px 18px rgba(37,99,235,0.08);
  color:var(--accent1);
  font-size:1rem;
}

/* search form (pill) */
#searchForm{
  display:flex;
  align-items:center;
  gap:.3rem;
  padding:3px 6px;
  border-radius:9999px;
  background: var(--surface);
  box-shadow: 0 6px 18px rgba(2,6,23,0.04);
  border: 1px solid rgba(15,23,42,0.05);
  transition: box-shadow .18s ease, transform .18s ease;
  max-width: 260px; 
}

/* focus state */
#searchForm:focus-within{
  box-shadow: 0 10px 28px rgba(37,99,235,0.08);
  transform: translateY(-1.5px);
  border-color: rgba(99,102,241,0.12);
}

/* input */
#searchInput{
  background: transparent;
  border: none;
  padding:.4rem .6rem;
  width: 100%;
  max-width: 180px;   /* <-- lebih ramping */
  font: 500 .9rem/1.2 'Inter', system-ui, sans-serif;
  color:var(--text);
  caret-color: var(--accent1);
  outline: none;
}

/* button */
#searchBtn{
  display:inline-flex;
  align-items:center;
  gap:.3rem;
  border:none;
  padding:.4rem .7rem;
  border-radius:9999px;
  font-weight:600;
  font-size:.85rem;
  color:#fff;
  background: linear-gradient(90deg,var(--accent1),var(--accent2));
  cursor:pointer;
  box-shadow: 0 8px 20px rgba(37,99,235,0.1);
  transition: transform .14s cubic-bezier(.2,.8,.2,1), box-shadow .14s ease;
}

/* hover/active */
#searchBtn:hover{ transform: translateY(-2px); box-shadow: 0 14px 28px rgba(37,99,235,0.14); }
#searchBtn:active{ transform: translateY(0); box-shadow: 0 6px 16px rgba(37,99,235,0.1); }

/* responsive */
@media (max-width:880px){
  .container{ padding:0 .9rem; }
  #searchForm{ max-width: 100%; }
  #searchInput{ max-width: 100%; }
}

@media (max-width:640px){
  header{ flex-direction:column; align-items:stretch; gap:.6rem; padding:.6rem 0; }
  header h1{ justify-content:center; width:100%; }
  #searchForm{ width:100%; max-width: 100%; } 
  #searchInput{ flex:1; width:100%; }
  #searchBtn{ padding:.5rem .7rem; font-size:.85rem; }
}

/* dark mode */
@media (prefers-color-scheme: dark){
  :root{ --text:#e6eef8; --muted:#9ca3af; --bg:#071025; --surface: rgba(10,14,20,0.55); }
  body{ background: linear-gradient(180deg,#041226 0%, #071025 60%); color:var(--text); }
  header{ background: linear-gradient(180deg, rgba(8,10,15,0.6), rgba(6,8,12,0.55)); border-bottom: 1px solid rgba(255,255,255,0.03); }
  #searchForm{ background: var(--surface); border: 1px solid rgba(255,255,255,0.03); box-shadow: 0 10px 30px rgba(2,6,23,0.45); }
  #searchInput{ color:var(--text); }
}

.rekom-text {
  font-size: 1rem; /* kecil */
  font-weight: 600;
  text-align: center; /* tengah */
  margin-bottom: 0.75rem;
  color: #ffff; /* bisa diganti sesuai tema */
}

/* Gradient untuk ikon */
.gradient-icon {
  background: linear-gradient(90deg, #3b82f6, #06b6d4); /* biru ke cyan */
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

/* ===========================
   Layout dasar agar footer di bawah
=========================== */
html, body {
  height: 100%;
  margin: 0;
  padding: 0;
}
/* ===========================
   Konten utama fleksibel
=========================== */
main {
  flex: 1; /* mengambil sisa ruang sehingga footer selalu di bawah */
  padding: 1rem;
}

/* ===========================
   Footer styling
=========================== */
.footer {
  background-color: var(--bg);
  color: var(--text);
  text-align: center;
  padding: 1rem 0 0; 
  border-radius: 1rem 1rem 0 0;
  font-family: 'Poppins', sans-serif;
  position: relative;
  flex-shrink: 0; /* jangan mengecil */
}

.footer .container {
  max-width: 600px;
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  gap: 0.2rem;
  align-items: center;
  padding: 0.75rem 1rem;
  border-radius: 1rem;
  transition: box-shadow 0.2s ease, transform 0.15s ease;
}

.footer .container:active {
  box-shadow: 0 8px 20px rgba(37,99,235,0.3);
  transform: translateY(-1px);
}

.footer .copyright {
  font-size: 0.8rem;
}
.footer p {
  margin: 0.5rem 0;
}
.footer .contact-icons {
  display: flex;
  justify-content: center;
  gap: 1rem;
  font-size: 1.3rem;
}

.footer .contact-icons a {
  transition: transform 0.2s;
  background: linear-gradient(90deg, var(--accent1), var(--accent2));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.footer .contact-icons a:active {
  transform: scale(1.2);
}

.footer .team {
  font-size: 0.75rem;
}

.footer::after {
  content: "";
  position: absolute;
  left: 0;
  right: 0;
  bottom: 0;
  height: 50px;
  background-color: var(--bg);
  z-index: -1;
}

.gradient-text {
  transition: transform 0.2s;
  background: linear-gradient(90deg, var(--accent1), var(--accent2));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

/* Dark mode */
@media (prefers-color-scheme: dark) {
  .footer {
    background-color: var(--surface, #0a0e14);
    color: var(--text, #e6eef8);
  }
}

/* Wrapper utama */
.anime-detail-wrapper {
  display: flex;
  flex-direction: column; /* foto di atas, info di bawah */
  gap: 2rem;
  align-items: center;
  padding: 1.5rem 0;
}

/* Container thumbnail + info */
.anime-thumb-container {
  position: relative;
  width: 100%;
  max-width: 600px;
  display: flex;
  flex-direction: column;
  align-items: center;
}

/* Wrapper utama untuk main thumb + overlay */
.main-thumb-wrapper {
  position: relative;
  width: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  margin: 0 auto;
}

/* Main thumb - foto utama */
.main-thumb {
  width: 100%;
  border-radius: 1rem;
  filter: blur(0.5px);
  box-shadow: 0 6px 18px rgba(2,6,23,0.04);
  transition: transform 0.25s ease, box-shadow 0.25s ease, filter 0.25s ease;
  will-change: transform, box-shadow, filter;
}

/* Overlay thumb - gambar kecil mengambang di atas main thumb */
.overlay-thumb {
  position: absolute;
  bottom: -20px; /* sedikit mengambang */
  left: 50%;
  transform: translateX(-50%);
  width: 120px;
  max-width: 40%;
  border-radius: 1rem;
  border: 2px solid rgba(15,23,42,0.08);
  box-shadow: 0 6px 20px rgba(2,6,23,0.08);
  background: var(--surface, #fff);
  transition: transform 0.25s ease, box-shadow 0.25s ease;
  z-index: 2;
}

.overlay-thumb:hover,
.overlay-thumb:active {
  transform: translateX(-50%) scale(1.1);
  box-shadow: 0 10px 28px rgba(37,99,235,0.14);
}

/* Info container - di bawah foto */
.anime-info-container {
  width: 100%;
  display: flex;
  flex-direction: column;
  gap: 1rem;
  margin-top: 60px; /* cukup spasi untuk overlay-thumb */
  text-align: center;
}

/* Judul */
.anime-title {
  font-size: 1.6rem;
  font-weight: 700;
  line-height: 1.4;
  margin: 0 0 0.5rem 0;
  color: var(--text);
  word-break: break-word;
}

/* Badge genre */
.anime-genres {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
}

.anime-genres .badge {
  display: inline-block;
  background: linear-gradient(135deg, var(--accent1), var(--accent2));
  color: #fff;
  padding: 4px 12px;
  margin: 3px 3px 3px 0;
  border-radius: 1.5rem;
  font-size: 0.85rem;
  font-weight: 500;
  transition: transform 0.25s ease, box-shadow 0.25s ease;
}

.anime-genres .badge:hover {
  transform: scale(1.08);
  box-shadow: 0 4px 12px rgba(37,99,235,0.15);
}

/* Info tabel */
.anime-info table {
  border-collapse: collapse;
  width: 100%;
  margin: 1rem 0;
  font-size: 0.95rem;
}

.anime-info table td {
  padding: 8px 12px;
  vertical-align: top;
  border-bottom: 1px solid rgba(15,23,42,0.08);
}

/* Episodes list - modern & jelas */
.anime-episodes ul {
  list-style: none;
  padding-left: 0;
  max-height: 320px;
  overflow-y: auto;
  scroll-behavior: smooth;
  border: 1px solid rgba(15,23,42,0.08);
  border-radius: 1rem;
  backdrop-filter: blur(6px);
  box-shadow: 0 5px 15px rgba(2,6,23,0.1);
}

/* Setiap episode */
.anime-episodes li {
  margin: 0;
}

/* Link episode */
.anime-episodes a {
  display: block;
  padding: 10px 12px;
  color: var(--accent1);
  text-decoration: none;
  transition: all 0.2s ease;
  border-bottom: 1px solid rgba(15,23,42,0.08);
  border-radius: 0.6rem;
  background: rgba(255,255,255,0.02); /* subtle background untuk setiap item */
}

/* Hover effect */
.anime-episodes a:hover {
  color: var(--accent2);
  background: rgba(37,99,235,0.08);
  transform: scale(1.01);
}

/* Episode aktif */
.anime-episodes a.active {
  background: rgba(37,99,235,0.15);
  font-weight: 600;
}

/* Scrollbar modern */
.anime-episodes ul::-webkit-scrollbar {
  width: 6px;
}

.anime-episodes ul::-webkit-scrollbar-thumb {
  background: rgba(37,99,235,0.6);
  border-radius: 3px;
}

.anime-episodes ul::-webkit-scrollbar-track {
  background: rgba(0,0,0,0.03);
}

/* Responsif mobile */
@media (max-width: 720px) {
  .main-thumb-wrapper {
    width: 90%;
  }

  .main-thumb {
    width: 100%;
  }

  .overlay-thumb {
    position: absolute; /* tetap mengambang di atas main-thumb */
    bottom: -100px;
    left: 50%;
    transform: translateX(-50%);
    width: 100px;
    max-width: 35%;
  }

  .anime-info-container {
    margin-top: 80px; /* cukup spasi untuk overlay-thumb */
    text-align: center;
  }
}

/* Dark mode */
@media (prefers-color-scheme: dark) {
  .anime-title { color: var(--text); }
  .anime-info table td { border-bottom: 1px solid rgba(255,255,255,0.08); }
  .anime-episodes a { color: var(--accent1); }
}

/* Play icon di tengah mainThumb */
.main-thumb-wrapper .play-icon {
  position: absolute;
  top: 40%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: rgba(37,99,235,0.8);
  filter: blur(0.2px);
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  z-index: 3;
  transition: transform 0.25s ease, background 0.25s ease;
}

.main-thumb-wrapper .play-icon i {
  color: #fff;
  font-size: 1.5rem;
}



/* Responsif mobile */
@media (max-width: 720px) {
  .main-thumb-wrapper .play-icon {
    width: 50px;
    height: 50px;
  }

  .main-thumb-wrapper .play-icon i {
    font-size: 1.2rem;
  }
}

/* button nonton episode */
.btn-watch-ep1 {
  display: inline-flex;
  align-items: center;
  justify-content: center; /* center teks & icon */
  gap: .3rem; /* jarak icon & teks */
  border: none;
  padding: .3rem .8rem; /* cukup nyaman dan proporsional */
  border-radius: 9999px; /* pill shape */
  font-weight: 600;
  font-size: .85rem;
  color: #fff;
  background: linear-gradient(90deg, var(--accent1, #ff416c), var(--accent2, #ff4b2b));
  cursor: pointer;
  box-shadow: 0 8px 20px rgba(37,99,235,0.1);
  transition: transform .14s cubic-bezier(.2,.8,.2,1), box-shadow .14s ease;
  white-space: nowrap; /* tetap satu baris */
}

.btn-watch-ep1 i {
  font-size: 0.9rem;
}

/* hover/active */
.btn-watch-ep1:hover {
  transform: translateY(-2px);
  box-shadow: 0 14px 28px rgba(37,99,235,0.14);
}

.btn-watch-ep1:active {
  transform: translateY(0);
  box-shadow: 0 6px 16px rgba(37,99,235,0.1);
}



/* ===========================
   Sidebar episode cards
=========================== */
#sidebarEpisodes .episode-card {
  border-radius: 1rem;
  overflow: hidden;
  box-shadow: 0 4px 16px rgba(2,6,23,0.08);
  background: var(--surface);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

#sidebarEpisodes .episode-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 28px rgba(37,99,235,0.15);
}

#sidebarEpisodes .episode-card img {
  width: 100%;
  height: 140px;
  object-fit: cover;
}

#sidebarEpisodes .episode-card p {
  margin: 0.25rem 0;
  padding: 0 0.5rem;
  color: var(--text);
}

#sidebarEpisodes .episode-card a {
  display: block;
  text-decoration: none;
}

/* responsive sidebar */
@media (max-width: 720px){
  #sidebarEpisodes {
    grid-template-columns: repeat(2, 1fr);
  }
  #sidebarEpisodes .episode-card img {
    height: 110px;
  }
}

@media (max-width: 480px){
  #sidebarEpisodes {
    grid-template-columns: 1fr;
  }
  #sidebarEpisodes .episode-card img {
    height: 100px;
  }
}

/* ===========================
   Container utama video
=========================== */
.video-card {
  max-width: 720px;
  margin: 2rem auto;
  padding: 1.5rem;
  border-radius: 1rem;
  background: var(--surface, #fff);
  box-shadow: 0 10px 28px rgba(0,0,0,0.08);
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.video-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 14px 40px rgba(0,0,0,0.12);
}

/* ===========================
   Wrapper video
=========================== */
.video-wrapper {
  position: relative;
  width: 100%;
  padding-top: 56.25%; /* 16:9 aspect ratio */
  border-radius: 1rem;
  overflow: hidden;
  box-shadow: 0 6px 18px rgba(2,6,23,0.08);
}

.video-wrapper iframe.video-iframe {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border: none;
  border-radius: 1rem;
}

/* ===========================
   Mirror dropdown
=========================== */
.mirror-container {
  display: flex;
  flex-direction: column; /* stack vertikal */
  align-items: center;    /* center teks dan select */
  gap: 0.25rem;           /* jarak antara teks dan dropdown */
  margin-bottom: 0.5rem;
}

.mirror-select {
  padding: 0.5rem 1rem;
  font-size: 0.95rem;
  font-weight: 500;
  border-radius: 0.6rem;
  border: 1px solid rgba(15,23,42,0.1);
  background: var(--surface, #fff);
  color: var(--text, #0f1724);
  border-color: var(--accent1, #2226f2ff);
  cursor: pointer;
  transition: box-shadow 0.2s ease, transform 0.2s ease;
  min-width: 150px;
}

.mirror-select:hover {
  box-shadow: 0 6px 18px rgba(37,99,235,0.15);
  transform: translateY(-1px);
  border-color: var(--accent1, #cf0d0dff);
}

.mirror-select:focus {
  outline: none;
  box-shadow: 0 8px 24px rgba(37,99,235,0.25);
}

.mirror-text {
  text-align: center;
  font-weight: 600;
  margin-bottom: 0.4rem;
  color: var(--text, #0f1724);
  font-size: 0.95rem;
}
/* ===========================
   Info Anime
=========================== */
.anime-info-container {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  text-align: center;
}

.anime-title {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--text, #0f1724);
}

.anime-info-container p {
  font-size: 0.9rem;
  color: var(--muted, #6b7280);
  margin: 0;
}

/* ===========================
   Anime Image Wrapper (no icon)
=========================== */
.anime-image-wrapper {
  position: relative;
  display: flex;
  justify-content: center;
  align-items: flex-end; /* fokus ke bagian bawah untuk overlay info */
  width: 100%;
  max-width: 720px;
  margin: 1.5rem auto;
  border-radius: 1rem;
  overflow: hidden;
  background: var(--surface, #fff);
  box-shadow: 0 10px 28px rgba(2,6,23,0.08);
  transition: transform 0.25s ease, box-shadow 0.25s ease;
  backdrop-filter: blur(6px); /* efek glass */
}

/* Thumbnail image */
.anime-image-wrapper img {
  width: 100%;
  display: block;
  border-radius: 1rem;
  object-fit: cover;
  transition: transform 0.25s ease, filter 0.25s ease, box-shadow 0.25s ease;
}

/* Hover efek */
.anime-image-wrapper:hover img {
  transform: scale(1.03);
  filter: brightness(1.05);
  box-shadow: 0 14px 40px rgba(37,99,235,0.14);
}

/* Gradient overlay */
.anime-image-wrapper::after {
  content: "";
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 35%; /* bisa diubah sesuai kebutuhan */
  background: linear-gradient(to top, rgba(37,99,235,0.4), transparent);
  pointer-events: none;
  transition: background 0.3s ease;
}

/* Hover overlay */
.anime-image-wrapper:hover::after {
  background: linear-gradient(to top, rgba(37,99,235,0.6), transparent);
}

/* Optional: text/info di atas overlay */
.anime-image-wrapper .overlay-text {
  position: absolute;
  bottom: 0.8rem;
  left: 1rem;
  right: 1rem;
  color: #fff;
  font-weight: 600;
  font-size: 1rem;
  text-shadow: 0 2px 6px rgba(0,0,0,0.5);
  z-index: 2;
  text-align: left;
  transition: transform 0.25s ease;
}

.anime-image-wrapper:hover .overlay-text {
  transform: translateY(-3px);
}

/* Responsive mobile */
@media (max-width: 720px) {
  .anime-image-wrapper {
    max-width: 95%;
  }
  .anime-image-wrapper .overlay-text {
    font-size: 0.9rem;
  }
}
/* ===========================
   Responsive
=========================== */
@media (max-width: 768px) {
  .video-card {
    padding: 1rem;
  }

  .anime-title {
    font-size: 1.3rem;
  }

  .mirror-select {
    width: 100%;
    max-width: 250px;
  }
}

/* ===========================
   Container episode scrollable - unified style
=========================== */
.anime-episodes {
  max-height: 360px;
  overflow-y: auto;
  padding: 0;
  border-radius: 1.25rem;
  box-shadow: 0 10px 20px rgba(2,6,23,0.12);
  background: var(--surface, #fff);
  border: none;
  backdrop-filter: blur(6px);
}

/* List */
.anime-episodes ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

/* Episode item - full width, border bottom */
.episode-bubble {
  display: flex;
  flex-direction: row;
  align-items: center;
  padding: 0.85rem 1.25rem;
  background: transparent; /* gabung background satu */
  cursor: pointer;
}

.episode-bubble:last-child {
  border-bottom: none; /* jangan ada garis di episode terakhir */
}


/* Thumbnail wrapper */
.episode-thumb-wrapper {
  flex-shrink: 0;
  margin-right: 0.75rem;
}

/* Thumbnail image */
.episode-thumb {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid rgba(37,99,235,0.5);
  transition: transform 0.3s ease;
}

.episode-bubble:hover .episode-thumb {
  transform: scale(1.05);
}

/* Info wrapper */
.episode-info {
  display: flex;
  flex-direction: column;
  justify-content: center;
  gap: 0.2rem;
}

/* Title & date */
.episode-title {
  font-weight: 700;
  color: #eee;
  font-size: 0.95rem;
  margin: 0;
}

.episode-date {
  font-size: 0.75rem;
  color: var(--muted, #64748b);
  margin: 0;
}

/* Dark mode */
@media (prefers-color-scheme: dark) {
  .anime-episodes {
    background: rgba(15,20,30,0.6);
    backdrop-filter: blur(6px);
  }
  .episode-bubble {
    border-bottom: 1px solid rgba(255,255,255,0.1);
  }
  .episode-date { color: #eee; }
}

/* Responsive mobile */
@media (max-width: 720px) {
  .episode-thumb {
    width: 40px;
    height: 40px;
  }
  .episode-info {
    gap: 0.1rem;
  }
}

.episode-header {
  text-align: center;
  color: rgba(255, 255, 255, 0.8); /* putih transparan */
  margin-bottom: 0.5rem;
  font-weight: 600;
}

.video-error-info {
  margin-top: 0.5rem;
  text-align: center;
  color: rgba(255, 255, 255, 0.8); /* putih transparan */
  font-size: 1rem;
  background tipis biar kelihatan */
  padding: 0.3rem 0.5rem;
  border-radius: 0.5rem;
}
</style>
</head>
<body class="text-gray-900 flex flex-col min-h-screen">

<header class="bg-white shadow p-4 flex justify-between items-center sticky top-0 z-50">
<h1 class="text-2xl font-bold text-blue-600 flex items-center gap-2">HUASTREAM.YYDZ</h1>
<form id="searchForm" class="flex items-center">
<input type="text" id="searchInput" placeholder="Cari Donghua atau Anime..." class="focus:outline-none px-2 py-1 border rounded" required>
<button type="submit" id="searchBtn" class="bg-blue-600 text-white px-3 py-2 hover:bg-blue-700 flex items-center gap-1"><i class="fas fa-search"></i> Cari</button>
</form>
</header>

<main class="flex-1 p-4 space-y-8">
  <div class="content" id="previewPlayer">
    <p class="text-center text-gray-500">Loading episode...</p>
  </div>
  <div id="mirrorButtons" class="flex flex-wrap gap-2 justify-center mt-4"></div>
    <div class="anime-episodes">
  <ul id="sidebarEpisodes"></ul>
</div>
</main>
<!-- Bottom Navigation -->
<nav class="bottom-nav">
  <a href="/donghua/home.html" class="nav-link active">
    <i class="fas fa-home"></i>
    <span>Home</span>
  </a>
  <a href="/donghua/search.html" class="nav-link">
    <i class="fas fa-search"></i>
    <span>Cari</span>
  </a>
  <a href="../bookmark.html" class="nav-link">
    <i class="fas fa-bookmark"></i>
    <span>Bookmark</span>
  </a>
  <a href="/donghua/profil.html" class="nav-link">
    <i class="fas fa-user"></i>
    <span>Akun</span>
  </a>
</nav>

<style>
/* ===========================
   Bottom Navigation Style
=========================== */
main {
  padding-bottom: 70px;
}
.bottom-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  display: flex;
  justify-content: space-around;
  background: var(--surface);
  backdrop-filter: blur(12px) saturate(120%);
  border-top: 1px solid rgba(15,23,42,0.05);
  padding: 0.5rem 0;
  z-index: 60;
  box-shadow: 0 -2px 8px rgba(0,0,0,0.05);
}

.bottom-nav .nav-link {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.2rem;
  color: var(--muted);
  font-size: 0.7rem;
  text-decoration: none;
  transition: all 0.2s ease;
  position: relative;
}

.bottom-nav .nav-link i {
  font-size: 1.2rem;
  transition: all 0.2s ease;
  background: linear-gradient(90deg, var(--accent1), var(--accent2));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.bottom-nav .nav-link.active i,
.bottom-nav .nav-link:hover i {
  transform: translateY(-2px) scale(1.1);
  filter: drop-shadow(0 2px 4px rgba(37,99,235,0.4));
}

.bottom-nav .nav-link.active span,
.bottom-nav .nav-link:hover span {
  color: var(--accent1);
  font-weight: 600;
}

@media (prefers-color-scheme: dark) {
  .bottom-nav {
    background: var(--surface);
    border-top: 1px solid rgba(255,255,255,0.05);
    box-shadow: 0 -2px 8px rgba(0,0,0,0.2);
  }

  .bottom-nav .nav-link {
    color: var(--muted);
  }

  .bottom-nav .nav-link.active span,
  .bottom-nav .nav-link:hover span {
    color: var(--accent1);
  }
}

/* Responsive: teks lebih kecil di mobile */
@media (max-width: 480px) {
  .bottom-nav .nav-link span {
    font-size: 0.65rem;
  }
  .bottom-nav .nav-link i {
    font-size: 1.1rem;
  }
}
</style>


<footer class="footer">
  <div class="container">
    <p class="copyright">
      Â© 2025 <strong>HUASTREAM.YYDZ</strong>. All rights reserved.
    </p>
    <p class="contact-icons">
      <a href="https://wa.me/6283872031397" target="_blank"><i class="fab fa-whatsapp"></i></a>
      <a href="https://t.me/Yudzxzy" target="_blank"><i class="fab fa-telegram-plane"></i></a>
      <a href="mailto:yudaaryaardhana1122@email.com"><i class="fas fa-envelope"></i></a>
    </p>
    <p class="team">Design & development <span class="font-semibold gradient-text">Tim Yudzxml</span></p>
  </div>
</footer>
<script src="../firebase.js"></script>
<script>
const previewContainer = document.getElementById('previewPlayer');
const mirrorButtonsContainer = document.getElementById('mirrorButtons');
const sidebarContainer = document.getElementById('sidebarEpisodes');
const epUrl = sessionStorage.getItem('targetData');

let currentUserId = null;

// Tunggu auth state Firebase
firebase.auth().onAuthStateChanged(user => {
  if(user) {
    currentUserId = user.uid;
    console.log("[Auth] User login:", currentUserId);
  } else {
    currentUserId = null;
    console.log("[Auth] User belum login");
  }
});

async function loadEpisode(url){
  if(!url){
    previewContainer.innerHTML = '<p class="text-center text-red-500">URL episode tidak ditemukan.</p>';
    return;
  }

  try {
    const res = await fetch(`https://api.yudzxyz.x-server.my.id/api/donghua?action=detail&url=${encodeURIComponent(url)}`);
    const data = await res.json();

    if(data.status !== 200){
      previewContainer.innerHTML = '<p class="text-center text-red-500">Gagal memuat data episode.</p>';
      return;
    }

    const result = data.result;
    const anime = result.anime;

    function renderVideo(videoUrl){
      previewContainer.innerHTML = `
<div class="video-card">
  <p class="video-error-info">
    <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
    Informasi:<br>
    Jika Stream gagal diputar, silahkan ganti link mirror/server di bawah
  </p>
  <div class="video-wrapper">
    <iframe src="${videoUrl}" frameborder="0" allowfullscreen class="video-iframe"></iframe>
  </div>
</div>

<div class="mirror-container">
  <p class="mirror-text">Pilih Mirror / Server:</p>
  <select id="mirrorSelect" class="mirror-select">
    ${result.mirrors.map(m => `
      <option value="${m.url}" ${m.url === videoUrl ? 'selected' : ''}>${m.name}</option>
    `).join('')}
  </select>
</div>

<div class="anime-info-container">
  <div class="anime-image-wrapper" style="text-align:center; margin-bottom:1rem;">
    <img src="${anime.image}" alt="${anime.animeTitle}" class="anime-image" style="max-width:70%; border-radius:1rem; box-shadow:0 8px 20px rgba(0,0,0,0.15);">
  </div>

  <h2 class="anime-title">${result.title}</h2>
  <p class="text-center text-gray-500">${anime.animeTitle} - Episode ${result.episode}</p>
  <p class="mt-2 text-sm text-gray-600">${anime.description}</p>
  <p class="mt-2 text-sm text-gray-600">Rating: ${anime.rating} | Status: ${anime.status} | Durasi: ${anime.durasi}</p>
  <p class="mt-2 text-sm text-gray-600">Genres: ${anime.genres.join(', ')}</p>
</div>
`;

      const mirrorSelect = document.getElementById('mirrorSelect');
      mirrorSelect.addEventListener('change', (e) => renderVideo(e.target.value));
    }

    renderVideo(result.mainVideo);

    // Simpan progress ke Firestore HANYA jika user login
    if(currentUserId){
      saveAnimeProgress({
        path: window.location.pathname,
        animeTitle: anime.animeTitle,
        episode: result.episode,
        dateSaved: new Date().toISOString(),
        episodeUrl: url,
        imageUrl: anime.image
      }, currentUserId);
    } else {
      console.log("[Histori] User belum login, tidak menyimpan episode ini:", anime.animeTitle, "Episode", result.episode);
    }

    sidebarContainer.innerHTML = `
<div class="anime-episodes">
<h3 class="episode-header">Episode:</h3>
<ul>
  ${result.sidebarEpisodes.map(ep => `
    <li class="episode-bubble">
      <div class="episode-thumb-wrapper">
        <img src="${ep.thumbnail}" alt="${ep.title}" class="episode-thumb">
      </div>
      <div class="episode-info">
        <a href="#" class="episode-link" data-link="${ep.link}">
          <p class="episode-title">${ep.title}</p>
        </a>
        <p class="episode-date">${ep.date}</p>
      </div>
    </li>
  `).join('')}
</ul>
</div>
`;

  } catch(err){
    console.error(err);
    previewContainer.innerHTML = '<p class="text-center text-red-500">Terjadi kesalahan saat memuat episode.</p>';
  }
}

// Sidebar click
sidebarContainer.addEventListener('click', e => {
  const link = e.target.closest('.episode-link');
  if(!link) return;
  e.preventDefault();
  const epLink = link.dataset.link;
  if(!epLink) return;
  sessionStorage.setItem('targetData', epLink);
  window.location.href = '/donghua/preview.html';
});

// Search form
document.getElementById('searchForm').addEventListener('submit', e => {
  e.preventDefault();
  const query = document.getElementById('searchInput').value.trim();
  if (!query) return;
  sessionStorage.setItem('searchQuery', query);
  window.location.href = `/donghua/search.html`;
});

loadEpisode(epUrl);

// --- Fungsi simpan ke Firestore ---
function saveAnimeProgress({path, animeTitle, episode, dateSaved, episodeUrl, imageUrl}, userId){
  if(!userId){
    console.log("[Histori] Tidak ada user login, skip menyimpan.");
    return;
  }

  const userDoc = firebase.firestore().collection('users').doc(userId);

  userDoc.get().then(doc => {
    let data = doc.data() || {};
    let animeEpisodes = data[animeTitle] || [];

    // Cek apakah episode sudah ada
    const existingIndex = animeEpisodes.findIndex(ep => ep.episode === episode && ep.episodeUrl === episodeUrl);

    if(existingIndex !== -1){
      // Jika sudah ada, update dateSaved
      animeEpisodes[existingIndex].dateSaved = dateSaved;
      console.log(`[Histori] Episode sudah ada, dateSaved diperbarui: ${animeTitle} - Episode ${episode}`);
    } else {
      // Jika belum ada, tambahkan episode baru
      animeEpisodes.push({path, episode, dateSaved, episodeUrl, imageUrl});
      console.log(`[Histori] Menyimpan episode baru: ${animeTitle} - Episode ${episode}`);
    }

    // Sort berdasarkan dateSaved, ambil 5 terbaru
    animeEpisodes.sort((a,b) => new Date(a.dateSaved) - new Date(b.dateSaved));
    if(animeEpisodes.length > 5){
      animeEpisodes = animeEpisodes.slice(-5);
    }

    console.log(`[Histori] 5 episode terakhir untuk ${animeTitle}:`, animeEpisodes.map(ep => ({episode: ep.episode, url: ep.episodeUrl, dateSaved: ep.dateSaved})));

    // Simpan ke Firestore
    userDoc.set({
      ...data,
      [animeTitle]: animeEpisodes
    }, {merge: true})
    .then(() => console.log("[Histori] Data tersimpan ke Firestore"))
    .catch(err => console.error("[Histori] Gagal menyimpan ke Firestore:", err));

  }).catch(err => console.error("[Histori] Gagal membaca data user:", err));
}
</script>
</body>
</html>