<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="utf-8">
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="all">
    <title>HUASTREAM | Nonton Donghua & Anime Bahasa Indonesia</title>
    <meta name="description" content="HUASTREAM.YYDZ adalah tempat nonton donghua dan anime online terlengkap dengan subtitle Indonesia. Mulai dari Action, Fantasy, Romance, Isekai, Comedy, hingga Cultivation dan Martial Arts, semua bisa kamu tonton gratis dengan kualitas terbaik. Koleksi lengkap donghua terbaru dan anime populer tersedia di HUASTREAM.YYDZ untuk pengalaman menonton seru tanpa batas.">
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="HUASTREAM.YYDZ" />
    <meta property="og:title" content="HUASTREAM | Nonton Donghua & Anime Bahasa Indonesia" />
    <meta property="og:image" content="https://raw.githubusercontent.com/Yudzxml/UploaderV2/main/tmp/55337a9f.png" />
   <meta property="og:description" content="HUASTREAM.YYDZ adalah platform nonton donghua dan anime terbaru dengan subtitle Indonesia. Koleksi lengkap dari Action, Fantasy, Isekai, Romance, hingga Cultivation bisa kamu tonton gratis!" />
   <meta property="og:url" content="https://huastream.yydz.my.id" />
   <meta name="keywords" content="nonton donghua, nonton anime, donghua sub indo, anime sub indo, streaming anime, streaming donghua, anime terbaru, donghua terbaru, huastream" itemprop="keywords" />
   <meta content="Nonton anime dan donghua sub indo terbaru hari ini dengan kualitas terbaik hanya di HUASTREAM.YYDZ." itemprop="headline" />
    <meta name="thumbnailUrl" content="https://raw.githubusercontent.com/Yudzxml/UploaderV2/main/tmp/55337a9f.png" itemprop="thumbnailUrl" />
    <meta content="https://huastream.yydz.my.id" itemprop="url" />
    <link rel="canonical" href="https://huastream.yydz.my.id" />
    <link rel="icon" href="https://raw.githubusercontent.com/Yudzxml/UploaderV2/main/tmp/26250dc9.png">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="manifest" href="../manifest.json" />
    <meta name="theme-color" content="#2563eb" />
     <script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("../service-worker.js")
     }
  </script>
  
  <!-- Tailwind CSS -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.2/dist/tailwind.min.css" rel="stylesheet">
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  
  <!-- Font Awesome 6 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Firebase App (core) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  
  <!-- Firebase Auth -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  
  <!-- Firebase Firestore -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  
<style>
*,
*::before,
*::after { box-sizing: border-box; }

:root{
  --bg:#f6f8fb;
  --surface: rgba(255,255,255,0.85);
  --text:#0f1724;
  --muted:#6b7280;
  --accent1:#2563eb;
  --accent2:#7c3aed;
  --glass: rgba(255,255,255,0.6);
}

html,body{ height:100%; }

body{
  margin:0;
  font-family:'Poppins', 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  background: linear-gradient(180deg,#fbfdff 0%, #eef6ff 40%, var(--bg) 100%);
  color:var(--text);
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  line-height:1.4;
  -webkit-tap-highlight-color: transparent;
}

.container{
  max-width:1200px;
  margin:0 auto;
  padding:0 1rem;
}

/* header */
header{
  position:sticky;
  top:0;
  z-index:60;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:1rem;
  padding:.65rem 0;
  backdrop-filter: blur(8px) saturate(120%);
  background: linear-gradient(180deg, rgba(255,255,255,0.7), rgba(255,255,255,0.55));
  border-bottom: 1px solid rgba(15,23,42,0.04);
  transition: box-shadow .22s ease, transform .18s ease;
}

header.elev{ box-shadow: 0 8px 30px rgba(15,23,42,0.06); transform: translateY(-1px); }

/* logo */
header h1{
  display:flex;
  align-items:center;
  gap:.6rem;
  margin:0;
  font-weight:800;
  font-size:1.25rem;
  letter-spacing:-0.2px;

  /* Gradient */
  background: linear-gradient(90deg, var(--accent1), var(--accent2));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent; 
  background-clip: text; 
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}


/* search form (pill) */
#searchForm{
  display:flex;
  align-items:center;
  gap:.3rem;
  padding:3px 6px;
  border-radius:9999px;
  background: var(--surface);
  box-shadow: 0 6px 18px rgba(2,6,23,0.04);
  border: 1px solid rgba(15,23,42,0.05);
  transition: box-shadow .18s ease, transform .18s ease;
  max-width: 260px; 
}

/* focus state */
#searchForm:focus-within{
  box-shadow: 0 10px 28px rgba(37,99,235,0.08);
  transform: translateY(-1.5px);
  border-color: rgba(99,102,241,0.12);
}

/* input */
#searchInput{
  background: transparent;
  border: none;
  padding:.4rem .6rem;
  width: 100%;
  max-width: 180px;   /* <-- lebih ramping */
  font: 500 .9rem/1.2 'Inter', system-ui, sans-serif;
  color: #eee
  caret-color: var(--accent1);
  outline: none;
}

/* button */
#searchBtn{
  display:inline-flex;
  align-items:center;
  gap:.3rem;
  border:none;
  padding:.4rem .7rem;
  border-radius:9999px;
  font-weight:600;
  font-size:.85rem;
  color:#fff;
  background: linear-gradient(90deg,var(--accent1),var(--accent2));
  cursor:pointer;
  box-shadow: 0 8px 20px rgba(37,99,235,0.1);
  transition: transform .14s cubic-bezier(.2,.8,.2,1), box-shadow .14s ease;
}

/* hover/active */
#searchBtn:hover{ transform: translateY(-2px); box-shadow: 0 14px 28px rgba(37,99,235,0.14); }
#searchBtn:active{ transform: translateY(0); box-shadow: 0 6px 16px rgba(37,99,235,0.1); }

/* responsive */
@media (max-width:880px){
  .container{ padding:0 .9rem; }
  #searchForm{ max-width: 100%; }
  #searchInput{ max-width: 100%; }
}

@media (max-width:640px){
  header{ flex-direction:column; align-items:stretch; gap:.6rem; padding:.6rem 0; }
  header h1{ justify-content:center; width:100%; }
  #searchForm{ width:100%; max-width: 100%; } 
  #searchInput{ flex:1; width:100%; }
  #searchBtn{ padding:.5rem .7rem; font-size:.85rem; }
}

/* dark mode */
@media (prefers-color-scheme: dark){
  :root{ --text:#e6eef8; --muted:#9ca3af; --bg:#071025; --surface: rgba(10,14,20,0.55); }
  body{ background: linear-gradient(180deg,#041226 0%, #071025 60%); color:var(--text); }
  header{ background: linear-gradient(180deg, rgba(8,10,15,0.6), rgba(6,8,12,0.55)); border-bottom: 1px solid rgba(255,255,255,0.03); }
  #searchForm{ background: var(--surface); border: 1px solid rgba(255,255,255,0.03); box-shadow: 0 10px 30px rgba(2,6,23,0.45); }
  #searchInput{ color:var(--text); }
}

.gradient-icon {
  transition: transform 0.2s;
  background: linear-gradient(90deg, var(--accent1), var(--accent2));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

html, body {
  height: 100%;
  margin: 0;
  padding: 0;
}

main {
  flex: 1; 
  padding: 1rem;
}
.footer {
  background-color: var(--bg);
  color: var(--text);
  text-align: center;
  padding: 1rem 0 0; 
  border-radius: 1rem 1rem 0 0;
  font-family: 'Poppins', sans-serif;
  position: relative;
  flex-shrink: 0;
}
.footer .container {
  max-width: 600px;
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  gap: 0.2rem;
  align-items: center;
  padding: 0.75rem 1rem;
  border-radius: 1rem;
  transition: box-shadow 0.2s ease, transform 0.15s ease;
}
.footer .container:active {
  box-shadow: 0 8px 20px rgba(37,99,235,0.3);
  transform: translateY(-1px);
}
.footer .copyright {
  font-size: 0.8rem;
}
.footer p {
  margin: 0.5rem 0;
}
.footer .contact-icons {
  display: flex;
  justify-content: center;
  gap: 1rem;
  font-size: 1.3rem;
}
.footer .contact-icons a {
  transition: transform 0.2s;
  background: linear-gradient(90deg, var(--accent1), var(--accent2));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}
.footer .contact-icons a:active {
  transform: scale(1.2);
}
.footer .team {
  font-size: 0.75rem;
}
.footer::after {
  content: "";
  position: absolute;
  left: 0;
  right: 0;
  bottom: 0;
  height: 50px;
  background-color: var(--bg);
  z-index: -1;
}
.gradient-text {
  transition: transform 0.2s;
  background: linear-gradient(90deg, var(--accent1), var(--accent2));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}
@media (prefers-color-scheme: dark) {
  .footer {
    background-color: var(--surface, #0a0e14);
    color: var(--text, #e6eef8);
  }
}
</style>
<style>
/* =======================
   TOAST CENTER
======================= */
#toast {
  position: fixed;
  top: 20rem;
  left: 50%;
  transform: translateX(-50%) translateY(-20px) scale(0.95); 
  min-width: 220px;
  max-width: 300px;
  padding: 0.75rem 1rem;
  border-radius: 0.75rem;
  font-family: 'Inter','Poppins',sans-serif;
  font-weight: 600;
  font-size: 0.95rem;
  color: #fff;
  box-shadow: 0 8px 20px rgba(0,0,0,0.12);
  backdrop-filter: blur(6px) saturate(120%);
  background: var(--surface);
  opacity: 0;
  pointer-events: none;
  transition: all 0.3s cubic-bezier(.2,.8,.2,1);
  z-index: 50;
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
}
#toast.show {
  opacity: 1;
  transform: translateX(-50%) translateY(0) scale(1);
  pointer-events: auto;
}
#toast.success { background: linear-gradient(90deg, #10b981, #3b82f6); }
#toast.error { background: linear-gradient(90deg, #ef4444, #f87171); }
#toast i { margin-right: 0.5rem; font-size: 1.1rem; }

@media (max-width:640px){
  #toast {
    left: 50%;
    right: auto;
    min-width: auto;
  }
}

/* =======================
   LOGIN CONTAINER
======================= */
#loginContainer {
  max-width: 380px;
  margin: 3rem auto;
  padding: 2rem 1.5rem;
  background: var(--surface);
  backdrop-filter: blur(12px) saturate(120%);
  border-radius: 1rem;
  box-shadow: 0 10px 25px rgba(15,23,42,0.1);
  text-align: center;
  transition: box-shadow 0.2s ease, transform 0.15s ease;
}
#loginContainer:active { box-shadow: 0 14px 30px rgba(37,99,235,0.2); transform: translateY(-1px); }
#loginContainer h2 { font-family:'Poppins'; font-size:1.25rem; font-weight:700; margin-bottom:1.5rem; color:var(--text); }
#googleLoginBtn {
  display: flex; align-items:center; justify-content:center; gap:0.6rem;
  width:100%; padding:0.65rem 1rem; font-size:0.95rem; font-weight:600;
  border:none; border-radius:9999px; color:#fff; cursor:pointer;
  background: linear-gradient(90deg,#ea4335,#dd2c00);
  box-shadow:0 6px 18px rgba(234,67,53,0.3);
  transition: transform 0.14s cubic-bezier(.2,.8,.2,1), box-shadow 0.14s ease;
}
#googleLoginBtn:hover { transform: translateY(-2px); box-shadow:0 12px 28px rgba(234,67,53,0.4); }
#googleLoginBtn:active { transform: translateY(0); box-shadow:0 4px 14px rgba(234,67,53,0.25); }
#googleLoginBtn i { font-size:1.2rem; }
@media(max-width:480px){
  #loginContainer{margin:2rem 1rem;padding:1.5rem 1rem;}
  #loginContainer h2{font-size:1.1rem;}
  #googleLoginBtn{font-size:0.9rem;padding:0.55rem 0.9rem;}
}
@media(prefers-color-scheme:dark){
  #loginContainer{background: rgba(10,14,20,0.6); color:var(--text);}
}

/* =======================
   BOTTOM NAV
======================= */
main{padding-bottom:70px;}
.bottom-nav{
  position:fixed;bottom:0;left:0;right:0;
  display:flex;justify-content:space-around;
  background:var(--surface);backdrop-filter:blur(12px) saturate(120%);
  border-top:1px solid rgba(15,23,42,0.05); padding:0.5rem 0; z-index:60; box-shadow:0 -2px 8px rgba(0,0,0,0.05);
}
.bottom-nav .nav-link{
  display:flex;flex-direction:column;align-items:center;gap:0.2rem;
  color:var(--muted); font-size:0.7rem; text-decoration:none; transition: all 0.2s ease; position:relative;
}
.bottom-nav .nav-link i{
  font-size:1.2rem; transition: all 0.2s ease; background: linear-gradient(90deg,var(--accent1),var(--accent2));
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
}
.bottom-nav .nav-link.active i, .bottom-nav .nav-link:hover i{
  transform:translateY(-2px) scale(1.1); filter: drop-shadow(0 2px 4px rgba(37,99,235,0.4));
}
.bottom-nav .nav-link.active span, .bottom-nav .nav-link:hover span{
  color:var(--accent1); font-weight:600;
}
@media(prefers-color-scheme:dark){
  .bottom-nav{background:var(--surface); border-top:1px solid rgba(255,255,255,0.05); box-shadow:0 -2px 8px rgba(0,0,0,0.2);}
  .bottom-nav .nav-link{color:var(--muted);}
  .bottom-nav .nav-link.active span,.bottom-nav .nav-link:hover span{color:var(--accent1);}
}
@media(max-width:480px){.bottom-nav .nav-link span{font-size:0.65rem;} .bottom-nav .nav-link i{font-size:1.1rem;}}
</style>
<style>
  /* =======================
   PROFILE CONTAINER
======================= */
#profileContainer {
  max-width:400px;
  margin:2rem auto;
  padding:1.5rem;
  background: var(--surface);
  backdrop-filter: blur(12px) saturate(120%);
  border-radius:1rem;
  box-shadow:0 12px 28px rgba(15,23,42,0.1);
  opacity:0;
  visibility:hidden;
  transform:translateY(-10px);
  transition: opacity 0.3s ease, transform 0.3s ease, visibility 0.3s;
  text-align: center; /* center semua konten default */
}

#profileContainer.show {
  opacity:1;
  visibility:visible;
  transform:translateY(0);
}

#profileContainer:active {
  transform:translateY(-1px);
  box-shadow:0 16px 32px rgba(15,23,42,0.15);
}

#profileContainer h2 {
  font-size:1.4rem;
  font-weight:800;
  margin-bottom:1rem;
  text-align:center;
  background: linear-gradient(90deg,var(--accent1),var(--accent2));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}

#profileContainer img#profilePic {
  width:96px;
  height:96px;
  border-radius:50%;
  border:2px solid rgba(0,0,0,0.1);
  object-fit:cover;
  transition: transform 0.2s;
  margin: 0 auto; /* center image */
}

#profileContainer img#profilePic:hover {
  transform: scale(1.05);
}

.profile-info {
  margin-bottom:1rem;
  text-align: center; /* center label, span, input */
}

.profile-info label {
  display:block;
  font-weight:600;
  margin-bottom:0.3rem;
  color:var(--text);
}

.profile-info input {
  width:100%;
  max-width:250px; /* supaya tidak terlalu lebar di desktop */
  margin: 0 auto; /* center input */
  padding:0.5rem 0.7rem;
  border-radius:0.5rem;
  border:1px solid rgba(15,23,42,0.1);
  background: rgba(255,255,255,0.85);
  font-family:'Inter';
  font-size:0.95rem;
  color:var(--text);
  outline:none;
  transition: box-shadow 0.2s, transform 0.2s;
}

.profile-info input:focus {
  box-shadow:0 6px 18px rgba(37,99,235,0.1);
  transform:translateY(-1px);
  border-color:var(--accent1);
}

.profile-info span {
  display:block;
  font-size:0.95rem;
  color:var(--muted);
}

#logoutBtn {
  width:100%;
  max-width:250px; /* center dan batasi lebar */
  padding:0.6rem 0;
  border-radius:9999px;
  font-weight:600;
  font-size:0.95rem;
  background: linear-gradient(90deg,var(--accent1),var(--accent2));
  color:#fff;
  border:none;
  cursor:pointer;
  box-shadow:0 8px 20px rgba(37,99,235,0.15);
  transition:transform 0.14s cubic-bezier(.2,.8,.2,1), box-shadow 0.14s ease;
  display:block;
  margin: 0 auto; /* center button */
}

#logoutBtn:hover {
  transform:translateY(-2px);
  box-shadow:0 14px 28px rgba(37,99,235,0.25);
}

#logoutBtn:active {
  transform:translateY(0);
  box-shadow:0 6px 16px rgba(37,99,235,0.12);
}

@media(max-width:480px){
  #profileContainer {
    padding:1rem;
    margin:1.5rem;
  }
  #profileContainer h2 { font-size:1.2rem; }
  #profileContainer img#profilePic { width:80px; height:80px; }
  .profile-info input { font-size:0.9rem; max-width: 100%; }
  #logoutBtn { font-size:0.9rem; max-width: 100%; }
}

@media(prefers-color-scheme:dark){
  #profileContainer {
    background:rgba(10,14,20,0.6);
    box-shadow:0 12px 28px rgba(0,0,0,0.5);
  }
  .profile-info input {
    background:rgba(20,24,32,0.6);
    border:1px solid rgba(255,255,255,0.1);
    color:var(--text);
  }
  .profile-info span { color:var(--muted); }
}

/* =======================
   EDIT USERNAME FORM
======================= */
#editUsernameForm {
  margin-top: 1rem;
  text-align: center; /* semua elemen di form center */
}

#editUsernameForm label {
  display: block;
  font-weight: 600;
  margin-bottom: 0.3rem;
  color: var(--text);
}

#editUsernameForm input {
  width: 100%;
  max-width: 250px; /* batasi lebar supaya rapi */
  margin: 0 auto 0.5rem auto; /* center dan beri jarak bawah */
  padding: 0.5rem 0.7rem;
  border-radius: 0.5rem;
  border: 1px solid rgba(15,23,42,0.1);
  background: rgba(255,255,255,0.85);
  font-family: 'Inter';
  font-size: 0.95rem;
  color: var(--text);
  outline: none;
  transition: box-shadow 0.2s, transform 0.2s;
}

#editUsernameForm input:focus {
  box-shadow: 0 6px 18px rgba(37,99,235,0.1);
  transform: translateY(-1px);
  border-color: var(--accent1);
}

#updateUsernameBtn {
  width: 100%;
  max-width: 250px; /* sama seperti tombol logout */
  padding: 0.6rem 0;
  border-radius: 9999px;
  font-weight: 600;
  font-size: 0.95rem;
  background: linear-gradient(90deg,var(--accent1),var(--accent2));
  color: #fff;
  border: none;
  cursor: pointer;
  box-shadow: 0 8px 20px rgba(37,99,235,0.15);
  transition: transform 0.14s cubic-bezier(.2,.8,.2,1), box-shadow 0.14s ease;
  display: block;
  margin: 0 auto; /* center tombol */
}

#updateUsernameBtn:hover {
  transform: translateY(-2px);
  box-shadow: 0 14px 28px rgba(37,99,235,0.25);
}

#updateUsernameBtn:active {
  transform: translateY(0);
  box-shadow: 0 6px 16px rgba(37,99,235,0.12);
}

/* Responsif */
@media(max-width:480px){
  #editUsernameForm input, 
  #updateUsernameBtn {
    max-width: 100%;
    font-size: 0.9rem;
  }
}

/* Dark mode */
@media(prefers-color-scheme:dark){
  #editUsernameForm input {
    background: rgba(20,24,32,0.6);
    border: 1px solid rgba(255,255,255,0.1);
    color: var(--text);
  }
}
#profileContainer .relative {
  position: relative;
}

#editProfileBtn {
  transition: transform 0.2s;
}

#editProfileBtn:hover {
  transform: scale(1.1);
}
</style>
</head>
<body class="text-gray-900">

<!-- HEADER -->
<header class="bg-white shadow p-4 flex justify-between items-center sticky top-0 z-50">
<h1 class="text-2xl font-bold text-blue-600 flex items-center gap-2">HUASTREAM.YYDZ</h1>
<form id="searchForm" class="flex items-center">
  <input type="text" id="searchInput" placeholder="Cari Donghua Favoritmu..." class="focus:outline-none px-2 py-1 border rounded">
  <button type="submit" id="searchBtn" class="bg-blue-600 text-white px-3 py-2 hover:bg-blue-700 flex items-center gap-1">
    <i class="fas fa-search"></i> Cari
  </button>
</form>
</header>

<!-- TOAST -->
<div id="toast"></div>

<!-- LOGIN -->
<div id="loginContainer">
  <h2>DAFTAR / LOGIN KE HUASTREAM</h2>
  <button id="googleLoginBtn"><i class="fab fa-google"></i> Login dengan Google</button>
</div>

<!-- PROFIL -->
<div id="profileContainer">
  <h2>INFORMASI AKUN</h2>

  <div class="flex justify-center mb-4 relative">
    <img id="profilePic" src="" alt="Avatar" class="rounded-full w-24 h-24">
    
    <!-- Tombol edit overlay -->
    <label for="profilePicInput" id="editProfileBtn" class="absolute bottom-0 right-0 bg-white border rounded-full p-1 shadow cursor-pointer hover:bg-gray-200">
      <i class="fas fa-edit text-sm"></i>
    </label>
    <input type="file" id="profilePicInput" accept="image/*" style="display:none">
  </div>

  <div class="profile-info mb-2">
    <label><i class="fas fa-user"></i> Username</label>
    <span id="usernameDisplay" class="font-bold text-lg block"></span>
  </div>
  
  <div class="profile-info mb-2">
  <label><i class="fas fa-user-shield"></i> Role</label>
  <span id="userRole">-</span>
</div>

  <div class="profile-info mb-2">
    <label><i class="fas fa-id-badge"></i> User ID</label>
    <span id="userId"></span>
  </div>

  <div class="profile-info mb-4">
    <label><i class="fas fa-clock"></i> Login At</label>
    <span id="loginAt"></span>
  </div>

  <button id="logoutBtn" class="mb-4 px-4 py-2 bg-red-500 text-white rounded">
    <i class="fas fa-sign-out-alt"></i> Logout
  </button>

  <div id="editUsernameForm" class="mb-4">
    <label><i class="fas fa-edit"></i> Edit Username</label>
    <input type="text" id="usernameInput" placeholder="Username baru" class="border p-2 rounded w-full mb-2">
    <button id="updateUsernameBtn" class="px-4 py-2 bg-blue-500 text-white rounded">
      <i class="fas fa-save"></i> Simpan
    </button>
  </div>
</div>

<!-- MAIN -->
<main>
  <!-- Bottom Nav -->
  <nav class="bottom-nav">
    <a href="/donghua/home.html" class="nav-link active"><i class="fas fa-home"></i><span>Home</span></a>
    <a href="/donghua/search.html" class="nav-link"><i class="fas fa-search"></i><span>Cari</span></a>
    <a href="../bookmark.html" class="nav-link"><i class="fas fa-bookmark"></i><span>Bookmark</span></a>
    <a href="/donghua/profil.html" class="nav-link"><i class="fas fa-user"></i><span>Akun</span></a>
  </nav>

  <!-- Footer -->
<footer class="footer">
  <div class="container">
    <p class="copyright">
      © 2025 <strong>HUASTREAM.YYDZ</strong>. All rights reserved.
    </p>
    <p class="contact-icons">
      <a href="https://wa.me/6283872031397" target="_blank" class="icon-gradient"><i class="fab fa-whatsapp"></i></a>
      <a href="https://t.me/Yudzxzy" target="_blank" class="icon-gradient"><i class="fab fa-telegram-plane"></i></a>
      <a href="mailto:yudaaryaardhana1122@email.com" class="icon-gradient"><i class="fas fa-envelope"></i></a>
    </p>
    <p class="team">
      Design & development <span class="font-semibold gradient-text">Tim Yudzxml</span>
    </p>
  </div>
</footer>
</main>
<script src="../firebase.js"></script>
<script>
// ============================
// --- CHANGE PROFILE PIC ---
// ============================
const profilePicInput = document.getElementById('profilePicInput');
const profilePic = document.getElementById('profilePic');

profilePicInput.addEventListener('change', async e => {
  const file = e.target.files[0];
  if (!file) return;

  const user = auth.currentUser;
  if (!user) {
    showToast('Silakan login terlebih dahulu', 'error');
    return;
  }

  // Preview lokal
  const reader = new FileReader();
  reader.onload = () => profilePic.src = reader.result;
  reader.readAsDataURL(file);

  try {
    // Baca file sebagai ArrayBuffer
    const arrayBuffer = await file.arrayBuffer();
    
    const response = await fetch('https://api-upload-cyan.vercel.app/api/upload', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/octet-stream',
        'x-filename': `${user.uid}_${Date.now()}_${file.name}`
      },
      body: arrayBuffer
    });

    const data = await response.json();
    if (!data?.data?.url) throw new Error(JSON.stringify(data));

    const downloadURL = data.data.url;

    // Update Firestore
    await db.collection('users').doc(user.uid).update({ profilePic: downloadURL });
    showToast('Foto profil berhasil diperbarui', 'success');

    // Update UI
    profilePic.src = downloadURL;

  } catch (err) {
    console.error('Upload error:', err);
    showToast('Gagal mengubah foto profil', 'error');
  }
});

// ============================
// --- TOAST --- 
// ============================
function showToast(message, type = 'success') {
  const toast = document.getElementById('toast');
  if (!toast) return;

  const icon = type === 'success' ? 'fas fa-check-circle' : 'fas fa-exclamation-circle';
  toast.innerHTML = `<i class="${icon}"></i> ${message}`;
  toast.className = `show ${type}`;

  setTimeout(() => {
    toast.className = '';
  }, 3000);
}

// ============================
// --- UI RESET --- 
// ============================
function resetUserUI() {
  if (loginContainer) loginContainer.style.display = 'block';
  if (profileContainer) profileContainer.classList.remove('show');

  profilePic.src = 'https://via.placeholder.com/96';
  document.getElementById('usernameDisplay').textContent = '';
  document.getElementById('usernameInput').value = '';
  document.getElementById('userRole').textContent = '';
  document.getElementById('userId').textContent = '';
  document.getElementById('loginAt').textContent = '';
}
// ============================
// --- UPDATE USER UI --- 
// ============================
async function updateUserUI(user) {
  if (!user) return resetUserUI();

  try {
    const doc = await db.collection('users').doc(user.uid).get();
    const data = doc.data() || {};

    if (loginContainer) loginContainer.style.display = 'none';
    if (profileContainer) profileContainer.classList.add('show');

    profilePic.src = data.profilePic || 'https://via.placeholder.com/96';
    document.getElementById('usernameDisplay').textContent = data.username || 'User';
    document.getElementById('usernameInput').value = data.username || '';
    document.getElementById('userRole').textContent = data.role || "User";
    document.getElementById('userId').textContent = user.uid;
    document.getElementById('loginAt').textContent = new Date().toLocaleString();
  } catch (err) {
    console.error(err);
    showToast('Gagal memuat profil', 'error');
    resetUserUI();
  }
}

// ============================
// --- UPDATE USERNAME --- 
// ============================
document.getElementById('updateUsernameBtn')?.addEventListener('click', async () => {
  const user = auth.currentUser;
  const usernameInput = document.getElementById('usernameInput');
  if (!user || !usernameInput) return;

  const newUsername = usernameInput.value.trim();
  if (!newUsername) {
    showToast('Username tidak boleh kosong', 'error');
    return;
  }

  try {
    await db.collection('users').doc(user.uid).update({ username: newUsername });
    document.getElementById('usernameDisplay').textContent = newUsername;
    showToast('Username berhasil diperbarui', 'success');
  } catch (err) {
    console.error(err);
    showToast('Gagal memperbarui username', 'error');
  }
});

// ============================
// --- GOOGLE LOGIN --- 
// ============================
const provider = new firebase.auth.GoogleAuthProvider();
document.getElementById('googleLoginBtn')?.addEventListener('click', async () => {
  try {
    const result = await auth.signInWithPopup(provider);
    const user = result.user;
    if (!user) throw new Error('User tidak ditemukan setelah login.');

    const userRef = db.collection('users').doc(user.uid);
    const doc = await userRef.get();

    if (!doc.exists) {
      await userRef.set({
        username: user.displayName || 'User',
        role: 'User',
        email: user.email || '',
        profilePic: user.photoURL || '',
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });
    }

    showToast(`Login berhasil! Selamat datang, ${user.displayName || 'User'}`, 'success');
    updateUserUI(user);
  } catch (err) {
    console.error(err);
    showToast(err.message || 'Terjadi kesalahan saat login', 'error');
  }
});

// ============================
// --- AUTH STATE ---
const loginContainer = document.getElementById('loginContainer');
const profileContainer = document.getElementById('profileContainer');

auth.onAuthStateChanged(user => updateUserUI(user));

// ============================
// --- LOGOUT ---
document.getElementById('logoutBtn')?.addEventListener('click', async () => {
  try {
    await auth.signOut();
    resetUserUI();
    showToast('Logout berhasil!', 'success');
  } catch (err) {
    console.error(err);
    showToast('Gagal logout', 'error');
  }
});

// ============================
// --- SEARCH ---
document.getElementById('searchForm')?.addEventListener('submit', e => {
  e.preventDefault();
  const searchInput = document.getElementById('searchInput');
  if (!searchInput) return;

  const query = searchInput.value.trim();
  if (!query) return;

  sessionStorage.setItem('searchQuery', query);
  window.location.href = '/donghua/search.html';
});

// ============================
// --- CONTACT LINKS ---
document.querySelectorAll('.contact-icons a').forEach(link => {
  link.addEventListener('click', e => {
    e.preventDefault();
    window.open(link.href, '_system');
  });
});
</script>
</body>
</html>